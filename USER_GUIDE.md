# 📦 調貨建議生成系統 v1.7a - 用戶手冊

## 🎯 系統概述

零售庫存調貨建議生成系統是一個基於Streamlit開發的智慧化庫存管理工具，專為零售業設計，能夠自動分析庫存數據並生成調貨建議，幫助優化庫存分佈和減少缺貨風險。

## 🚀 快速開始

### 1. 系統要求
- Python 3.8+
- 支持Excel文件格式 (.xlsx, .xls)
- 推薦使用Chrome或Firefox瀏覽器

### 2. 安裝步驟
```bash
# 1. 安裝依賴包
pip install -r requirements.txt

# 2. 啟動應用
streamlit run app.py

# 或使用快捷腳本
# Windows: run.bat
# Linux/macOS: ./run.sh
```

### 3. 訪問應用
啟動後在瀏覽器中訪問：`http://localhost:8501`

## 📊 功能詳解

### 核心功能模組

#### 1. 數據上傳與預處理
- **支持格式**：Excel (.xlsx, .xls)
- **自動驗證**：檢查必需欄位完整性
- **數據清理**：自動處理負值、異常值、空值
- **類型轉換**：智能轉換數據類型

#### 2. 調貨策略選擇

**A模式：保守轉貨**
- RF類型產品：(庫存+在途) × 20%限制，最少2件
- 適用於風險控制較嚴格的業務場景
- 優先轉出低銷量店鋪的過剩庫存

**B模式：加強轉貨**
- RF類型產品：(庫存+在途) × 50%限制，最少2件
- 基於MOQ+1件的安全邊際
- 更積極的庫存調配策略

#### 3. 智能匹配算法

**轉出優先順序**
1. ND類型完全轉出（不補貨產品）
2. RF類型過剩/加強轉出（補貨產品）

**接收優先順序**
1. 緊急缺貨補貨（庫存=0且有銷量）
2. 潛在缺貨補貨（庫存+在途 < 安全庫存）

#### 4. 統計分析
- **基本KPI**：總建議數、總件數、涉及產品數、涉及OM數
- **按產品統計**：每個產品的調貨情況
- **按OM統計**：各營運單位的調貨分佈
- **類型分析**：轉出和接收類型的詳細分佈

#### 5. 數據視覺化
- **橫條圖分析**：OM單位的轉出vs接收對比
- **動態圖表**：根據選擇的模式自動調整圖表標題
- **英文標籤**：避免中文字體相容性問題

#### 6. 報告匯出
- **Excel格式**：包含調貨建議和統計摘要兩個工作表
- **自動命名**：調貨建議_YYYYMMDD.xlsx
- **完整信息**：包含產品描述、庫存狀態、安全庫存等詳細信息

## 📋 數據格式要求

### 必需欄位列表

| 欄位名稱 | 數據類型 | 說明 | 示例 |
|---------|---------|------|------|
| Article | 字符串 | 產品編號 | "12345" |
| Article Description | 字符串 | 產品描述 | "產品A" |
| RP Type | 字符串 | 補貨類型 | "RF" or "ND" |
| Site | 字符串 | 店鋪編號 | "S001" |
| OM | 字符串 | 營運管理單位 | "OM01" |
| MOQ | 整數 | 最低派貨數量 | 10 |
| SaSa Net Stock | 整數 | 現有庫存數量 | 25 |
| Pending Received | 整數 | 在途訂單數量 | 5 |
| Safety Stock | 整數 | 安全庫存數量 | 15 |
| Last Month Sold Qty | 整數 | 上月銷量 | 8 |
| MTD Sold Qty | 整數 | 本月至今銷量 | 3 |

### 數據質量要求
- 所有數值欄位不能包含非數字字符
- RP Type只能是"ND"或"RF"
- 庫存和銷量數值不能為負數
- 建議每個Excel文件不超過10,000行記錄

## 🔍 業務邏輯說明

### 有效銷量計算
```
有效銷量 = 上月銷量 > 0 ? 上月銷量 : 本月至今銷量
```

### 轉出數量計算

**A模式（保守）：**
```
基礎可轉出 = (庫存+在途) - 安全庫存
上限控制 = max((庫存+在途) × 20%, 2)
實際轉出 = min(基礎可轉出, 上限控制, 實際庫存)
```

**B模式（加強）：**
```
基礎可轉出 = (庫存+在途) - (MOQ + 1)
上限控制 = max((庫存+在途) × 50%, 2)
實際轉出 = min(基礎可轉出, 上限控制, 實際庫存)
```

### 匹配約束條件
1. 同一產品同一OM才能匹配
2. 避免同一店鋪自我調貨
3. 優先滿足高優先順序需求
4. 調貨數量優化（1件時嘗試調高到2件）

## ⚠️ 注意事項

### 數據準備
- 確保Excel文件包含所有必需欄位
- 檢查數據格式和數值範圍
- 建議在上傳前備份原始數據

### 業務規則
- 系統不會推薦違反安全庫存規則的調貨
- ND類型產品會被優先安排完全轉出
- 調貨建議僅供參考，需結合實際業務情況決策

### 技術限制
- 大型數據集（>50MB）可能影響處理速度
- 圖表生成需要足夠的內存資源
- Excel匯出受瀏覽器下載限制影響

## 🆘 常見問題解答

**Q: 為什麼沒有生成調貨建議？**
A: 檢查數據是否滿足業務邏輯條件，如是否有過剩庫存、是否有缺貨需求等。

**Q: 圖表顯示異常或亂碼？**
A: 這通常是字體問題，系統已使用英文標籤來避免此問題。

**Q: Excel匯出失敗？**
A: 檢查瀏覽器是否允許下載，或嘗試使用不同瀏覽器。

**Q: 數據載入失敗？**
A: 驗證Excel文件格式和必需欄位，確保數據完整性。

## 📞 技術支持

如需技術支持或功能建議，請聯繫開發團隊：

**開發者：** Ricky  
**版本：** v1.7a  
**最後更新：** 2025-09-18

---

*本手冊涵蓋了系統的主要功能和使用方法。如有更詳細的技術問題，請參考源代碼註釋或聯繫開發團隊。*
